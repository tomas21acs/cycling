<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cyklistick√° kalkulaƒçka v√Ωkonu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container d-flex justify-content-between align-items-center">
        <a class="navbar-brand" href="/">üö¥‚Äç‚ôÇÔ∏è Cyklistick√° kalkulaƒçka v√Ωkonu</a>
        <div>
          <button id="login" class="btn btn-outline-light btn-sm">P≈ôihl√°sit se</button>
          <button id="logout" class="btn btn-outline-light btn-sm d-none">Odhl√°sit se</button>
        </div>
      </div>
    </nav>

    <main class="container pb-5">
      {% block content %}{% endblock %}
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    {% block scripts %}{% endblock %}

    <!-- Firebase Authentication -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } 
        from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

      // ‚ö†Ô∏è ZDE vlo≈æ sv≈Øj skuteƒçn√Ω Firebase config z konzole
      const firebaseConfig = {
        apiKey: "TV≈ÆJ_API_KEY",
        authDomain: "tvuj-projekt.firebaseapp.com",
        projectId: "tvuj-projekt",
        storageBucket: "tvuj-projekt.appspot.com",
        messagingSenderId: "XXXXXXXXXXXX",
        appId: "1:XXXXXXXXXXXX:web:XXXXXXXXXXXX"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      const loginBtn = document.getElementById("login");
      const logoutBtn = document.getElementById("logout");

      // P≈ôihl√°≈°en√≠ p≈ôes Google
      loginBtn.onclick = async () => {
        try {
          await signInWithPopup(auth, provider);
        } catch (error) {
          console.error("Chyba p≈ôi p≈ôihl√°≈°en√≠:", error);
        }
      };

      // Odhl√°≈°en√≠
      logoutBtn.onclick = () => signOut(auth);

      // Sleduj stav p≈ôihl√°≈°en√≠
      onAuthStateChanged(auth, (user) => {
        if (user) {
          loginBtn.classList.add("d-none");
          logoutBtn.classList.remove("d-none");
          console.log("‚úÖ P≈ôihl√°≈°en:", user.email);

          // Ulo≈æ ID u≈æivatele do localStorage pro Flask
          localStorage.setItem("firebase_uid", user.uid);
        } else {
          loginBtn.classList.remove("d-none");
          logoutBtn.classList.add("d-none");
          localStorage.removeItem("firebase_uid");
        }
      });
    </script>
  </body>
</html>
